<form role="form" [formGroup]="form" (submit)="save()">
  <div>
    <mat-form-field class="date-text" appearance="fill">
      <input
        matInput
        [formControl]="dateText"
        [placeholder]="label() || 'date'"
      />
      <mat-hint>A or A--B, era: BC/AD</mat-hint>
      <button
        type="button"
        matSuffix
        mat-icon-button
        aria-label="Clear text"
        matTooltip="Clear date text"
        (click)="resetDateText()"
      >
        <mat-icon class="mat-warn">close</mat-icon>
      </button>
      <button
        type="button"
        matSuffix
        mat-icon-button
        aria-label="Parse text"
        matTooltip="Parse date text"
        (click)="parseDateText()"
      >
        <mat-icon class="mat-primary">check_circle</mat-icon>
      </button>
    </mat-form-field>
    <span>
      @if (dateText.value && invalidDateText()) {
      <mat-icon class="mat-warn">error</mat-icon>
      }
    </span>
    <span>
      @if (!invalidDateText()) {
      <span class="date-sort-value"> {{ dateValue() | number : "1.2-2" }}</span>
      }
    </span>
    <button
      type="button"
      mat-icon-button
      matTooltip="Toggle visual editor"
      [disabled]="disabled()"
      (click)="visualExpanded.set(!visualExpanded())"
    >
      @if (visualExpanded()) {
      <mat-icon class="mat-primary">publish</mat-icon>
      } @if (!visualExpanded()) {
      <mat-icon class="mat-primary">get_app</mat-icon>
      }
    </button>
  </div>

  <mat-expansion-panel
    [expanded]="!disabled() && visualExpanded()"
    (expandedChange)="!disabled() && visualExpanded.set($event)"
  >
    <cadmus-refs-datation
      [datation]="a()"
      (datationChange)="onDatationAChange($event)"
      [label]="'A'"
    />

    @if (range.value) {
    <cadmus-refs-datation
      [datation]="b()"
      (datationChange)="onDatationBChange($event)"
      [label]="'B'"
    />
    }

    <div class="form-row">
      <mat-slide-toggle [formControl]="range" matTooltip="Toggle range"
        >A-B</mat-slide-toggle
      >
      <button
        type="button"
        mat-icon-button
        matTooltip="Reset date visuals"
        [disabled]="disabled()"
        (click)="resetDatations()"
      >
        <mat-icon class="mat-warn">clear</mat-icon>
      </button>
      <button
        type="button"
        mat-icon-button
        matTooltip="Set date from visuals"
        [disabled]="disabled()"
        (click)="setDatations()"
      >
        <mat-icon class="mat-primary">check_circle</mat-icon>
      </button>
    </div>
  </mat-expansion-panel>
</form>
